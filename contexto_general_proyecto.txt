# CONTEXTO GENERAL DEL PROYECTO

Este archivo reúne el contexto que una IA (p. ej., Claude) necesita para redactar la documentación final del proyecto según los requerimientos académicos adjuntos (título, problema, justificación, objetivos SMART, alcance, antecedentes, historias de usuario, etc.).

---

## 1) TÍTULO PROPUESTO DEL PROYECTO

Inventario y Facturación de Repuestos de Motos para Talleres (Backend Spring Boot + MongoDB, Web Next.js y App Android)

---

## 2) DESCRIPCIÓN DEL PROBLEMA

- Contexto: Los talleres de reparación y venta de repuestos para motos suelen gestionar inventario y facturación de forma manual o con herramientas desconectadas (Excel, cuadernos), generando errores de stock, demoras en ventas, poca trazabilidad y mala experiencia del cliente.
- Necesidad: Un sistema centralizado que permita gestionar catálogo de productos, stock por almacén, carritos, facturación y administración de talleres/miembros, integrándose con una web (Next.js) y una app Android orientada a cliente final (estilo Amazon/MercadoLibre) para explorar, agregar al carrito y comprar.
- Evidencia/justificación: Errores de inventario (quiebres/o sobrestock), tiempos de respuesta altos, falta de visibilidad por sucursales/almacenes, dificultad para auditar movimientos de stock y ventas.
- Actores involucrados:
  - Cliente (App Android): navega productos, filtra por categorías, agrega al carrito, compra.
  - Vendedor (taller): gestiona productos, stock, facturas.
  - Administrador de Taller: gestiona almacenes, invitaciones y roles de miembros.
  - Administrador de Plataforma: gestiona usuarios administradores y categorías globales.
  - Sistema Backend (Spring Boot + MongoDB): API REST, seguridad, lógica de negocio.
  - Frontend Web (Next.js): canal web de tienda y administración ligera.

---

## 3) JUSTIFICACIÓN (RELEVANCIA, IMPACTO, PERTINENCIA)

- Relevancia: Sector de motos en crecimiento; talleres requieren digitalización accesible y ágil.
- Impacto esperado: Reducción de errores de inventario (>60%), mejora en tiempos de venta (>30%), aumento de satisfacción del cliente (>20%).
- Pertinencia: Solución especializada para repuestos de motos con stock por almacén y gestión de talleres/miembros; integra canales web y móvil, con autenticación segura (JWT) y auditoría de movimientos.

---

## 4) OBJETIVO GENERAL Y OBJETIVOS ESPECÍFICOS (SMART)

- Objetivo general (SMART): Diseñar e implementar, en 8–10 semanas, una plataforma de inventario y facturación para repuestos de motos que integre Backend (Spring Boot + MongoDB), Web (Next.js) y App Android, con autenticación JWT y gestión de stock por almacén, logrando disminuir errores de inventario en al menos 60% y reducir tiempos de venta en 30% en pilotos.

- Objetivos específicos (SMART):
  1. Implementar un API REST segura con JWT y refresh tokens en 2 semanas, con endpoints de autenticación, catálogo, stock, carritos, facturas y talleres documentados en OpenAPI.
  2. Desarrollar gestión de stock por almacén con auditoría automática de movimientos y sincronización del stock total en 2 semanas.
  3. Implementar checkout desde carrito con validación de stock y numeración secuencial de facturas en 1 semana.
  4. Integrar invitaciones/roles de taller para administración descentralizada en 1 semana.
  5. Publicar Swagger UI y pruebas de humo, alcanzando 100% de arranque de contexto y >10 pruebas funcionales clave en 1–2 semanas.

---

## 5) ALCANCE DEL PROYECTO

- Funcionalidades incluidas:
  - Autenticación (JWT), refresh tokens, OAuth Google.
  - Catálogo de productos (creación/edición/consulta), categorías (globales y por taller).
  - Stock por almacén: ajuste delta y set absoluto; desglose por almacén; auditoría de movimientos.
  - Carritos (anónimo y autenticado), merge tras login, gestión de ítems.
  - Facturación: creación desde carrito o DTO, numeración secuencial, cálculo de totales.
  - Gestión de talleres: creación, almacenes, invitaciones por código, miembros/roles (ADMIN/VENDEDOR), políticas de permisos.
  - Favoritos de productos por usuario.
  - Documentación OpenAPI/Swagger.

- Entregables:
  - Backend funcional (jar), documentación técnica (OpenAPI, README), tablero de proyecto con historias y estados, documento Word/PDF final y Excel de historias.

- Exclusiones (no incluidas por ahora):
  - Pasarela de pagos, recuperación/cambio de contraseña, verificación por email.
  - Gestión avanzada de precios/impuestos/descuentos.
  - Transferencias entre almacenes y analítica avanzada.
  - Gestión de medios (subida de imágenes) en backend.

- Límites: Se centra en el backend y la integración con Next.js y Android; la UX/UI completa del ecommerce se realiza en los clientes web/móvil.

---

## 6) ANTECEDENTES (REFERENTES Y DIFERENCIADORES)

- Referentes: Amazon/MercadoLibre (modelo de experiencia de compra), Shopify/Prestashop (ecommerce general), ERPs con módulo de inventario.
- Diferenciadores del proyecto:
  - Especializado en repuestos de motos y talleres.
  - Stock por almacén con auditoría automática de movimientos.
  - Gestión de talleres, invitaciones por código y roles.
  - Integración natural con app Android y web Next.js.

---

## 7) HISTORIAS DE USUARIO (INSUMO PARA EXCEL)

Sugeridas (ejemplos, priorizar con MoSCoW y asignar responsables):
- HU-CLI-01: Como cliente quiero ver el catálogo y buscar por nombre/categoría para encontrar repuestos.
- HU-CLI-02: Como cliente quiero ver el detalle de un producto para conocer precio, stock y especificaciones.
- HU-CLI-03: Como cliente quiero agregar productos al carrito para comprarlos más tarde.
- HU-CLI-04: Como cliente quiero iniciar sesión/registrarme (incl. OAuth Google) para guardar mi carrito y favoritos.
- HU-CLI-05: Como cliente quiero marcar un producto como favorito para acceder rápido en el futuro.
- HU-CLI-06: Como cliente quiero hacer checkout del carrito para generar una factura.
- HU-VEN-01: Como vendedor quiero crear/editar productos para mantener el catálogo actualizado.
- HU-VEN-02: Como vendedor quiero ajustar stock por almacén para reflejar entradas/egresos.
- HU-VEN-03: Como vendedor quiero listar movimientos de stock para auditar cambios.
- HU-ADM-01: Como admin de taller quiero crear almacenes para organizar el stock por sede.
- HU-ADM-02: Como admin de taller quiero invitar miembros por código para asignar roles.
- HU-ADM-03: Como admin de taller quiero promover/demover/remover miembros para administrar permisos.
- HU-PLT-01: Como admin de plataforma quiero crear administradores para delegar gestión global.

Campos para Excel: ID, Descripción (Como [rol] quiero [acción] para [resultado]), Criterios de aceptación, Prioridad, Responsable, Estado.

---

## 8) REQUERIMIENTOS FUNCIONALES (RESUMEN)

- Autenticación y seguridad: login/register, refresh/logout, OAuth Google, perfil /me, revocación de tokens.
- Productos y categorías: CRUD (según rol), listado/búsqueda paginada, categorías globales/locales.
- Stock por almacén: consulta total/desglose, ajuste delta y set absoluto, eventos → movimientos.
- Carritos: crear anónimo/autenticado, agregar/quitar/vaciar, merge tras login.
- Facturas: crear desde carrito/DTO, numeración secuencial, totales server-side, consulta.
- Talleres/miembros: talleres, almacenes, invitaciones por código, promover/demover/remover.
- Favoritos: agregar/quitar/listar y ver si un producto es favorito.

---

## 9) REQUERIMIENTOS NO FUNCIONALES

- Seguridad: JWT Bearer, passwords bcrypt, refresh tokens con hash (SHA-256). Roles: CLIENT, VENDEDOR, ADMIN.
- Rendimiento: operaciones atómicas con Mongo FindAndModify; evitar N+1 en favoritos; tiempos de respuesta sub-segundo para CRUD comunes.
- Disponibilidad: stateless JWT; dependencia de MongoDB. Configurable por env vars.
- Mantenibilidad: endpoints documentados con OpenAPI; layering con controllers/services/repos.
- Escalabilidad: separación de stock por almacén e índices básicos; compatible con sharding futuro.
- Observabilidad: Actuator básico; logs de auth/refresh.

---

## 10) ARQUITECTURA Y TECNOLOGÍAS

- Backend: Java 21, Spring Boot 3.3, Spring Security, Spring Data MongoDB, Springdoc OpenAPI.
- DB: MongoDB (colecciones: users, productos, categorias, stock, movimientos, carritos, facturas, talleres, invitaciones, refresh_tokens, data).
- Clientes: Next.js (web), Android (Kotlin) — consumen la API REST.
- Seguridad: JWT (HS256), refresh tokens hash; OAuth Google vía tokeninfo; CORS configurable (por defecto http://localhost:3000).
- Documentación: Swagger UI (/swagger-ui.html), /v3/api-docs.

---

## 11) DATOS Y MODELO (RESUMEN)

- users: {username, email, password(bcrypt), roles[ADMIN|VENDEDOR|CLIENT], provider, activo, fechas}
- productos: {nombre, precio, stock total, categoriaId, tallerId, ownerId, listaMedios[], specs{}}
- categorias: {global si tallerId null, mappedGlobalCategoryId}
- stock: {productoId, almacenId, cantidad}
- movimientos: {tipo, productoId, cantidad, referencia, notas, realizadoPor, creadoEn}
- carritos: {usuarioId (o anónimo), items [{productoId, cantidad}], creadoEn}
- facturas: {numeroFactura (secuencia), cliente embebido y/o clienteId, items, total, realizadoPor, estado}
- talleres: {ownerId, nombre, almacenes[], miembros[{userId, roles[]}]}
- invitaciones: {tallerId, codeHash, role, redeemed, attempts, expiresAt}

---

## 12) FLUJOS PRINCIPALES Y CRITERIOS DE ACEPTACIÓN (RESUMEN)

- Catálogo: GET /api/productos y /api/categorias públicos; detalle de producto público.
  - Criterios: respuesta paginada con total/page/size; búsqueda por ‘q’ y filtro por categoría.
- Carrito: POST /api/carritos (anónimo o usuario). Mutaciones requieren owner autenticado.
  - Criterios: agregar actualiza cantidad; merge combina ítems y preserva totales.
- Checkout: POST /api/facturas/checkout (autenticado). Decrementa stock por almacenes disponibles; genera factura y vacía carrito.
  - Criterios: 201 con factura; 409 si stock insuficiente; total calculado server-side.
- Stock: POST /api/stock/adjust y PUT /api/stock/set (roles: ADMIN/VENDEDOR y permisos por taller); crea movimientos.
  - Criterios: ajuste atómico; evento de auditoría; sincronización de stock total en producto.
- Talleres: crear taller, crear almacén, invitación por código, promover/demover/remover.
  - Criterios: validación de permisos; códigos con expiración; límites razonables (p.ej., 3 talleres por owner, 5 almacenes por taller).
- Favoritos: agregar/quitar/listar; ver si un producto es favorito.
  - Criterios: requiere autenticación; evita duplicados.
- Admin: crear administradores con clave de bootstrap si no hay admin previo.
  - Criterios: valida adminKey o rol ADMIN del llamante; errores 403/409 adecuados.

---

## 13) SUPUESTOS Y RESTRICCIONES

- MongoDB disponible (MONGODB_URI); JWT secret >= 32 bytes (APP_JWT_SECRET); CORS configurado para Next.js.
- Integración OAuth Google requiere client-id válido (app.oauth.google.client-id por env var).
- Sin pasarela de pagos en esta fase; sin recuperación de contraseña ni verificación de email.

---

## 14) RIESGOS Y MITIGACIONES

- Configuración sensible (JWT secret, OAuth) mal gestionada → usar variables de entorno y ejemplos seguros.
- Endpoint POST /api/admin/users público a nivel HTTP (el servicio valida bootstrap) → recomendación: proteger por ROLE_ADMIN y mantener bootstrap controlado; documentar claramente.
- Cobertura de tests limitada → agregar pruebas de negocio para stock, checkout, invitaciones y carritos.
- Desfase de propiedad OAuth en properties → usar variable de entorno app.oauth.google.client-id.

---

## 15) MÉTRICAS DE ÉXITO (KPIs SUGERIDOS)

- Exactitud de stock (diferencia inventario vs. sistema) < 5%.
- Tiempo medio de venta (de agregar al carrito a factura) < 3 minutos.
- Tasa de error en operaciones de checkout < 1%.
- Uptime backend > 99% en periodo de evaluación.

---

## 16) ENTORNO Y EJECUCIÓN (BREVE)

- Backend: Java 21, Spring Boot 3.3, MongoDB local por defecto (27017). Swagger UI: /swagger-ui.html.
- Variables clave: MONGODB_URI, APP_JWT_SECRET, APP_CORS_ALLOWED_ORIGINS, app.oauth.google.client-id.

---

## 17) TABLERO DE PROYECTO (TRELLO/JIRA/CLICKUP/NOTION)

- Columnas sugeridas: Backlog, En progreso, En revisión, Hecho.
- Cargar historias de usuario (ID, descripción, criterios, prioridad, responsable, estado) y asignar responsables.
- Invitar al docente para verificación y seguimiento.

---

## 18) REFERENCIAS Y ENLACES

- Swagger UI: /swagger-ui.html
- OpenAPI JSON: /v3/api-docs
- Repos relacionados: Web Next.js (consumidor), App Android (consumidor).

---

## 19) NOTAS PARA LA IA QUE GENERARÁ EL DOCUMENTO

- Usa este contexto para redactar el documento final con las secciones exigidas: Título, Descripción del problema, Justificación, Objetivo general y específicos (SMART), Alcance (incluye/excluye), Antecedentes, Historias de usuario (como lista y generar Excel ‘HistoriasUsuario_[NombreProyecto].xlsx’), y Resumen de entregables.
- Mantén un tono claro y académico, con bullets y párrafos cortos; incluye métricas y criterios de aceptación cuando apliquen.
- Añade diagramas opcionales (arquitectura, flujo principal) si la plataforma lo permite.

---

## 20) ALCANCE POR PLATAFORMA (APP ANDROID VS WEB NEXT.JS)

- App Android (cliente final):
  - Autenticación: registro, inicio de sesión, OAuth Google, refresh, logout.
  - Catálogo: listar/buscar productos y categorías, ver detalle (precio, especificaciones y disponibilidad), ver productos relacionados; mostrar stock total (opcional) sin exponer ubicación de almacenes.
  - Favoritos: agregar/quitar, listar y comprobar si un producto es favorito.
  - Carrito: crear carrito anónimo, persistir carrito de usuario, agregar/quitar/actualizar cantidades, vaciar; merge automático tras login.
  - Checkout: confirmar compra a partir del carrito (POST /api/facturas/checkout); mostrar resultado con número de factura.
  - Perfil e historial: ver perfil (/api/auth/me) y listar facturas propias; consultar factura por id/número.
  - UX móvil: experiencia tipo marketplace (Amazon/MercadoLibre) enfocada a navegación y compra.

- Web Next.js (panel de administración y, opcionalmente, storefront):
  - Administración de catálogo: crear/editar/eliminar productos; gestionar categorías globales y por taller. Gestión de medios (subida/edición) se maneja del lado del cliente (no hay endpoint de media en backend).
  - Stock por almacén: panel para consultar y ajustar stock (delta y set), eliminar registros de stock y ver total consolidado; auditoría de movimientos.
  - Movimientos: listar por producto/tipo, ver detalle.
  - Talleres y almacenes: crear taller, crear almacén, listar talleres propios.
  - Invitaciones y miembros: crear invitaciones por código; promover/demover/remover miembros del taller.
  - Usuarios administradores: crear administradores (sólo rol ADMIN; primer admin por clave de bootstrap).
  - Facturación (backoffice): listar facturas, ver por id/número; emisión manual (opcional) usando el endpoint tipado.
  - Storefront web (opcional): se puede replicar catálogo/carrito/checkout para canal web en fases siguientes, pero por ahora el canal cliente preferente es Android.

- Principios de reparto:
  - La App Android concentra la experiencia del cliente final (descubrimiento, carrito, favoritos, checkout).
  - La Web Next.js concentra la administración (catálogo, stock, movimientos, talleres/miembros, invitaciones, facturas y usuarios admin). El storefront web es opcional y posterior.
  - Las operaciones de escritura sensibles (stock, catálogo, gestión de miembros) quedan en Web Next.js con roles VENDEDOR/ADMIN.

- Definición explícita de roles por plataforma:
  - App Android: SOLO rol CLIENT. No puede crear/editar productos, ajustar stock, gestionar talleres/miembros ni emitir facturas manuales (solo checkout propio).
  - Web Next.js: roles VENDEDOR y ADMIN. Pueden gestionar catálogo, stock por almacén, movimientos, talleres/miembros, invitaciones y administración de usuarios (admins), además de consultar/gestionar facturas en backoffice.
